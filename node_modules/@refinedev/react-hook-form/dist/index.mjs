"use client"
var ee=Object.defineProperty;var R=(e,a)=>ee(e,"name",{value:a,configurable:!0});import{useEffect as z}from"react";import te from"lodash-es/get.js";import re from"lodash-es/has.js";import{useForm as se}from"react-hook-form";import{useForm as ae,useWarnAboutChange as oe,useTranslate as ne,useRefineContext as de,flattenObjectKeys as J}from"@refinedev/core";var k=R(({refineCoreProps:e,warnWhenUnsavedChanges:a,disableServerSideValidation:c=!1,...H}={})=>{let{options:y}=de(),h=(y==null?void 0:y.disableServerSideValidation)||c,S=ne(),{warnWhenUnsavedChanges:U,setWarnWhen:f}=oe(),V=a??U,o=se({...H}),{watch:m,setValue:E,getValues:u,handleSubmit:n,setError:x}=o,b=ae({...e,onMutationError:(t,i,r)=>{var F,v;if(h){(F=e==null?void 0:e.onMutationError)==null||F.call(e,t,i,r);return}let s=t==null?void 0:t.errors;for(let g in s){if(!Object.keys(J(i)).includes(g))continue;let l=s[g],D="";Array.isArray(l)&&(D=l.join(" ")),typeof l=="string"&&(D=l),typeof l=="boolean"&&l&&(D="Field is not valid."),typeof l=="object"&&"key"in l&&(D=S(l.key,l.message)),x(g,{message:D})}(v=e==null?void 0:e.onMutationError)==null||v.call(e,t,i,r)}}),{query:p,onFinish:d,formLoading:B,onFinishAutoSave:M}=b;z(()=>{var r;let t=(r=p==null?void 0:p.data)==null?void 0:r.data;if(!t)return;Object.keys(J(u())).forEach(s=>{let F=re(t,s),v=te(t,s);F&&E(s,v)})},[p==null?void 0:p.data,E,u]),z(()=>{let t=m((i,{type:r})=>{r==="change"&&W(i)});return()=>t.unsubscribe()},[m]);let W=R(t=>{var i,r;if(V&&f(!0),(i=e==null?void 0:e.autoSave)!=null&&i.enabled){f(!1);let s=((r=e.autoSave)==null?void 0:r.onFinish)??(F=>F);return M(s(t)).catch(F=>F)}return t},"onValuesChange"),C=R((t,i)=>async r=>(f(!1),n(t,i)(r)),"handleSubmit");return{...o,handleSubmit:C,refineCore:b,saveButtonProps:{disabled:B,onClick:t=>{C(i=>d(i).catch(()=>{}),()=>!1)(t)}}}},"useForm");import{useEffect as Te,useState as ie}from"react";import le from"lodash-es/get.js";var ue=R(({stepsProps:e,...a}={})=>{let{defaultStep:c=0,isBackValidate:H=!1}=e??{},[y,h]=ie(c),S=k({...a}),{trigger:U,getValues:f,setValue:V,formState:{dirtyFields:o},refineCore:{query:m}}=S;Te(()=>{var b;let n=(b=m==null?void 0:m.data)==null?void 0:b.data;if(!n)return;let x=Object.keys(f());console.log({dirtyFields:o,registeredFields:x,data:n}),Object.entries(n).forEach(([p,d])=>{let B=p;x.includes(B)&&(le(o,B)||V(B,d))})},[m==null?void 0:m.data,y,V,f]);let E=R(n=>{let x=n;n<0&&(x=0),h(x)},"go");return{...S,steps:{currentStep:y,gotoStep:R(async n=>{if(n===y)return;if(n<y&&!H){E(n);return}await U()&&E(n)},"gotoStep")}}},"useStepsForm");import{useCallback as X}from"react";import{useGo as pe,useModal as ce,useParsed as me,useResource as Fe,useUserFriendlyName as Re,useTranslate as ye,useWarnAboutChange as Ee,useInvalidate as xe}from"@refinedev/core";import $ from"react";var be=R(({modalProps:e,refineCoreProps:a,syncWithLocation:c,...H}={})=>{var N,I;let y=xe(),[h,S]=$.useState(!1),U=ye(),{resource:f,action:V}=a??{},{resource:o,action:m,identifier:E}=Fe(f),u=me(),n=pe(),x=Re(),b=V??m??"",p=!(typeof c=="object"&&(c==null?void 0:c.syncId)===!1),d=typeof c=="object"&&"key"in c?c.key:o&&b&&c?`modal-${E}-${b}`:void 0,{defaultVisible:B=!1,autoSubmitClose:M=!0,autoResetForm:W=!0,autoResetFormWhenClose:C=!0}=e??{},O=k({refineCoreProps:{...a,meta:{...d?{[d]:void 0}:{},...a==null?void 0:a.meta}},...H}),{reset:t,refineCore:{onFinish:i,id:r,setId:s,autoSaveProps:F},saveButtonProps:v,handleSubmit:g}=O,{visible:Q,show:l,close:D}=ce({defaultVisible:B});$.useEffect(()=>{var T,j,P,G;if(h===!1&&d){let w=(j=(T=u==null?void 0:u.params)==null?void 0:T[d])==null?void 0:j.open;if(typeof w=="boolean"?w&&l():typeof w=="string"&&w==="true"&&l(),p){let Y=(G=(P=u==null?void 0:u.params)==null?void 0:P[d])==null?void 0:G.id;Y&&(s==null||s(Y))}S(!0)}},[d,u,p,s]),$.useEffect(()=>{var T;h===!0&&(Q&&d?n({query:{[d]:{...(T=u==null?void 0:u.params)==null?void 0:T[d],open:!0,...p&&r&&{id:r}}},options:{keepQuery:!0},type:"replace"}):d&&!Q&&n({query:{[d]:void 0},options:{keepQuery:!0},type:"replace"}))},[r,Q,l,d,p]);let K=R(async T=>{await i(T),M&&D(),W&&t()},"submit"),{warnWhen:A,setWarnWhen:Z}=Ee(),_=X(()=>{var T;if(F.status==="success"&&((T=a==null?void 0:a.autoSave)!=null&&T.invalidateOnClose)&&y({id:r,invalidates:a.invalidates||["list","many","detail"],dataProviderName:a.dataProviderName,resource:E}),A)if(window.confirm(U("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))Z(!1);else return;s==null||s(void 0),D(),C&&t()},[A,F.status]),q=X(T=>{typeof T<"u"&&(s==null||s(T)),(!(b==="edit"||b==="clone")||(typeof T<"u"||typeof r<"u"))&&l()},[r]),L=U(`${E}.titles.${V}`,void 0,`${x(`${V} ${((N=o==null?void 0:o.meta)==null?void 0:N.label)??((I=o==null?void 0:o.options)==null?void 0:I.label)??(o==null?void 0:o.label)??E}`,"singular")}`);return{modal:{submit:K,close:_,show:q,visible:Q,title:L},...O,saveButtonProps:{...v,onClick:T=>g(K)(T)}}},"useModalForm");export{k as useForm,be as useModalForm,ue as useStepsForm};
//# sourceMappingURL=index.mjs.map