"use client"
var ue=Object.create;var w=Object.defineProperty;var pe=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,Fe=Object.prototype.hasOwnProperty;var E=(e,t)=>w(e,"name",{value:t,configurable:!0});var Re=(e,t)=>{for(var r in t)w(e,r,{get:t[r],enumerable:!0})},ee=(e,t,r,D)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ce(t))!Fe.call(e,n)&&n!==r&&w(e,n,{get:()=>t[n],enumerable:!(D=pe(t,n))||D.enumerable});return e};var K=(e,t,r)=>(r=e!=null?ue(me(e)):{},ee(t||!e||!e.__esModule?w(r,"default",{value:e,enumerable:!0}):r,e)),ye=e=>ee(w({},"__esModule",{value:!0}),e);var Ee={};Re(Ee,{useForm:()=>k,useModalForm:()=>ne,useStepsForm:()=>oe});module.exports=ye(Ee);var z=require("react"),te=K(require("lodash/get")),re=K(require("lodash/has")),se=require("react-hook-form"),x=require("@refinedev/core");var k=E(({refineCoreProps:e,warnWhenUnsavedChanges:t,disableServerSideValidation:r=!1,...D}={})=>{let{options:n}=(0,x.useRefineContext)(),v=(n==null?void 0:n.disableServerSideValidation)||r,H=(0,x.useTranslate)(),{warnWhenUnsavedChanges:g,setWarnWhen:B}=(0,x.useWarnAboutChange)(),h=t??g,d=(0,se.useForm)({...D}),{watch:R,setValue:b,getValues:m,handleSubmit:T,setError:f}=d,V=(0,x.useForm)({...e,onMutationError:(s,p,a)=>{var y,Q;if(v){(y=e==null?void 0:e.onMutationError)==null||y.call(e,s,p,a);return}let o=s==null?void 0:s.errors;for(let C in o){if(!Object.keys((0,x.flattenObjectKeys)(p)).includes(C))continue;let c=o[C],S="";Array.isArray(c)&&(S=c.join(" ")),typeof c=="string"&&(S=c),typeof c=="boolean"&&c&&(S="Field is not valid."),typeof c=="object"&&"key"in c&&(S=H(c.key,c.message)),f(C,{message:S})}(Q=e==null?void 0:e.onMutationError)==null||Q.call(e,s,p,a)}}),{query:F,onFinish:i,formLoading:U,onFinishAutoSave:A}=V;(0,z.useEffect)(()=>{var a;let s=(a=F==null?void 0:F.data)==null?void 0:a.data;if(!s)return;Object.keys((0,x.flattenObjectKeys)(m())).forEach(o=>{let y=(0,re.default)(s,o),Q=(0,te.default)(s,o);y&&b(o,Q)})},[F==null?void 0:F.data,b,m]),(0,z.useEffect)(()=>{let s=R((p,{type:a})=>{a==="change"&&N(p)});return()=>s.unsubscribe()},[R]);let N=E(s=>{var p,a;if(h&&B(!0),(p=e==null?void 0:e.autoSave)!=null&&p.enabled){B(!1);let o=((a=e.autoSave)==null?void 0:a.onFinish)??(y=>y);return A(o(s)).catch(y=>y)}return s},"onValuesChange"),M=E((s,p)=>async a=>(B(!1),T(s,p)(a)),"handleSubmit");return{...d,handleSubmit:M,refineCore:V,saveButtonProps:{disabled:U,onClick:s=>{M(p=>i(p).catch(()=>{}),()=>!1)(s)}}}},"useForm");var P=require("react"),ae=K(require("lodash/get"));var oe=E(({stepsProps:e,...t}={})=>{let{defaultStep:r=0,isBackValidate:D=!1}=e??{},[n,v]=(0,P.useState)(r),H=k({...t}),{trigger:g,getValues:B,setValue:h,formState:{dirtyFields:d},refineCore:{query:R}}=H;(0,P.useEffect)(()=>{var V;let T=(V=R==null?void 0:R.data)==null?void 0:V.data;if(!T)return;let f=Object.keys(B());console.log({dirtyFields:d,registeredFields:f,data:T}),Object.entries(T).forEach(([F,i])=>{let U=F;f.includes(U)&&((0,ae.default)(d,U)||h(U,i))})},[R==null?void 0:R.data,n,h,B]);let b=E(T=>{let f=T;T<0&&(f=0),v(f)},"go");return{...H,steps:{currentStep:n,gotoStep:E(async T=>{if(T===n)return;if(T<n&&!D){b(T);return}await g()&&b(T)},"gotoStep")}}},"useStepsForm");var J=require("react"),u=require("@refinedev/core");var $=K(require("react"));var ne=E(({modalProps:e,refineCoreProps:t,syncWithLocation:r,...D}={})=>{var Z,_;let n=(0,u.useInvalidate)(),[v,H]=$.default.useState(!1),g=(0,u.useTranslate)(),{resource:B,action:h}=t??{},{resource:d,action:R,identifier:b}=(0,u.useResource)(B),m=(0,u.useParsed)(),T=(0,u.useGo)(),f=(0,u.useUserFriendlyName)(),V=h??R??"",F=!(typeof r=="object"&&(r==null?void 0:r.syncId)===!1),i=typeof r=="object"&&"key"in r?r.key:d&&V&&r?`modal-${b}-${V}`:void 0,{defaultVisible:U=!1,autoSubmitClose:A=!0,autoResetForm:N=!0,autoResetFormWhenClose:M=!0}=e??{},I=k({refineCoreProps:{...t,meta:{...i?{[i]:void 0}:{},...t==null?void 0:t.meta}},...D}),{reset:s,refineCore:{onFinish:p,id:a,setId:o,autoSaveProps:y},saveButtonProps:Q,handleSubmit:C}=I,{visible:j,show:c,close:S}=(0,u.useModal)({defaultVisible:U});$.default.useEffect(()=>{var l,W,Y,q;if(v===!1&&i){let O=(W=(l=m==null?void 0:m.params)==null?void 0:l[i])==null?void 0:W.open;if(typeof O=="boolean"?O&&c():typeof O=="string"&&O==="true"&&c(),F){let L=(q=(Y=m==null?void 0:m.params)==null?void 0:Y[i])==null?void 0:q.id;L&&(o==null||o(L))}H(!0)}},[i,m,F,o]),$.default.useEffect(()=>{var l;v===!0&&(j&&i?T({query:{[i]:{...(l=m==null?void 0:m.params)==null?void 0:l[i],open:!0,...F&&a&&{id:a}}},options:{keepQuery:!0},type:"replace"}):i&&!j&&T({query:{[i]:void 0},options:{keepQuery:!0},type:"replace"}))},[a,j,c,i,F]);let G=E(async l=>{await p(l),A&&S(),N&&s()},"submit"),{warnWhen:X,setWarnWhen:de}=(0,u.useWarnAboutChange)(),Te=(0,J.useCallback)(()=>{var l;if(y.status==="success"&&((l=t==null?void 0:t.autoSave)!=null&&l.invalidateOnClose)&&n({id:a,invalidates:t.invalidates||["list","many","detail"],dataProviderName:t.dataProviderName,resource:b}),X)if(window.confirm(g("warnWhenUnsavedChanges","Are you sure you want to leave? You have unsaved changes.")))de(!1);else return;o==null||o(void 0),S(),M&&s()},[X,y.status]),ie=(0,J.useCallback)(l=>{typeof l<"u"&&(o==null||o(l)),(!(V==="edit"||V==="clone")||(typeof l<"u"||typeof a<"u"))&&c()},[a]),le=g(`${b}.titles.${h}`,void 0,`${f(`${h} ${((Z=d==null?void 0:d.meta)==null?void 0:Z.label)??((_=d==null?void 0:d.options)==null?void 0:_.label)??(d==null?void 0:d.label)??b}`,"singular")}`);return{modal:{submit:G,close:Te,show:ie,visible:j,title:le},...I,saveButtonProps:{...Q,onClick:l=>C(G)(l)}}},"useModalForm");
//# sourceMappingURL=index.cjs.map